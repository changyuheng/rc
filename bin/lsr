#!/system/bin/sh
#!/usr/bin/env sh

#
# find -ls
#
. /system/bin/.gbrc

list() {
	local cwd="$1"
	case "$1" in
		*/) ;;
		?*) cwd="$1/" ;;
		"") cwd="./" ;;
	esac

	for i in "$cwd".*; do
		case "$i" in
			"") ;;
			".") ;;
			"..") ;;
			/".") ;;
			/"..") ;;
			*/".") ;;
			*/"..") ;;
			?*)
				if ls -l -s -d "$i" > /dev/null 2>&1; then
					ls -l -s -d "$i" |
					while read line; do
						echo -e "$line\t$cwd"
						# replace last column
						#case "$line" in
						#	?*' -> '?*)
						#		echo "$line"
						#		;;
						#	?*)
						#		name=`echo "${line##* *-*-* *:* }"`
						#		pre=`echo "${line% *}"`
						#		echo "$pre $cwd$name"
						#		;;
						#esac
					done
				fi
				;;
		esac
	done
	for i in "$cwd"*; do
		if ls -l -s -d "$i" > /dev/null 2>&1; then
			ls -l -s -d "$i" |
			while read line; do
				echo -e "$line\t$cwd"
				# replace last column
				#case "$line" in
				#	?*' -> '?*)
				#		echo "$line"
				#		;;
				#	?*)
				#		name=`echo "${line##* *-*-* *:* }"`
				#		pre=`echo "${line% *}"`
				#		echo "$pre $cwd$name"
				#		;;
				#esac
			done
		fi
	done
	next=`echo "$cwd"*/`
	for i in $next; do
		if ls "$i" > /dev/null 2>&1; then
			list "$i"
		fi
	done
	next=`echo "$cwd".*/`
	for i in $next; do
		case "$i" in
			"") ;;
			".") ;;
			"..") ;;
			/".") ;;
			/"..") ;;
			*/".") ;;
			*/"..") ;;
			*/"."/) ;;
			*/".."/) ;;
			*/"."/*) ;;
			*/".."/*) ;;
			?*)
				if ls "$i" > /dev/null 2>&1; then
					list "$i"
				fi
				;;
		esac
	done
}

for i in "$@"; do
	list "$i"
done

